<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced QR Code Generator - VIN NESIA</title>
    
    <meta name="description" content="A premium, real-time QR Code Generator with a built-in scanner, bulk generation, and smart color palette extraction. Create professional QR codes with custom frames, logos, and advanced styling.">
    <meta name="keywords" content="qr code generator, qr code scanner, bulk qr code, premium qr generator, professional vcard qr, vin nesia">
    <meta name="author" content="VIN NESIA">
    <link rel="canonical" href="https://qr.vinnesia.my.id">
    <meta name="theme-color" content="#10101a">
    <link rel="manifest" id="manifest-link">

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <script src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <style>
        /* --- [START] PREMIUM CSS UPGRADE --- */

        /* 1. ROOT VARIABLES & DYNAMIC THEME */
        :root {
            --color-background: #0d0d1a;
            --color-surface: rgba(20, 20, 35, 0.5);
            --color-primary: #5271ff;
            --color-secondary: #ad5bff;
            --color-success: #10b981;
            --color-danger: #ef4444;
            --color-text: #f0f0f5;
            --color-text-muted: #a0a0b0;
            --color-border: rgba(255, 255, 255, 0.1);
            --glass-blur: 16px;
            --transition-speed: 0.4s;
            --border-radius: 12px;
        }

        /* 2. ADVANCED ANIMATIONS */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes aurora {
            0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; }
        }
        @keyframes modal-fade-in { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* 3. DYNAMIC BACKGROUND & BODY */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.7;
            overflow-x: hidden;
            transition: background var(--transition-speed) ease;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(at 20% 20%, hsla(220, 80%, 50%, 0.2) 0px, transparent 50%),
                        radial-gradient(at 80% 20%, hsla(280, 80%, 50%, 0.2) 0px, transparent 50%),
                        radial-gradient(at 20% 80%, hsla(180, 80%, 50%, 0.2) 0px, transparent 50%),
                        radial-gradient(at 80% 80%, hsla(340, 80%, 50%, 0.2) 0px, transparent 50%);
            z-index: -1;
            animation: aurora 20s ease infinite;
            background-size: 400% 400%;
        }

        /* 4. LAYOUT & HEADER */
        .container { width: 90%; max-width: 1200px; margin: 2rem auto; animation: fadeIn 1s ease-out forwards; }
        header { text-align: center; padding: 2rem 1rem; }
        header h1 { margin: 0; font-size: 3em; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 1rem; }
        header p { color: var(--color-text-muted); font-size: 1.2em; margin-top: 0.5rem; max-width: 600px; margin-left: auto; margin-right: auto; }
        .logo-img { height: 50px; }
        main { display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; align-items: flex-start; }

        /* 5. PROFESSIONAL CARD STYLING */
        .controls, .output {
            background: var(--color-surface);
            padding: 2rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border);
            backdrop-filter: blur(var(--glass-blur));
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: all var(--transition-speed) ease;
        }
        .output { position: sticky; top: 2rem; }

        /* 6. ENHANCED TABS */
        .tabs-container { display: flex; flex-wrap: wrap; gap: 0.5rem; border-bottom: 1px solid var(--color-border); padding-bottom: 1.5rem; margin-bottom: 1.5rem; }
        .tab-button {
            display: flex; align-items: center; gap: 0.5rem; padding: 0.6rem 1rem;
            cursor: pointer; border: 1px solid transparent; background: transparent; color: var(--color-text-muted);
            border-radius: var(--border-radius); transition: all 0.2s ease;
            font-size: 0.9em; font-weight: 600;
        }
        .tab-button:hover { background-color: rgba(255, 255, 255, 0.05); color: var(--color-text); }
        .tab-button.active {
            background: var(--color-primary); color: white; border-color: var(--color-primary);
            box-shadow: 0 4px 15px rgba(82, 113, 255, 0.3); transform: translateY(-2px);
        }
        .tabs-content-viewport { overflow: hidden; position: relative; min-height: 280px; }
        .tabs-content-wrapper { display: flex; transition: transform var(--transition-speed) ease-in-out; }
        .tab-content { width: 100%; flex-shrink: 0; display: block; }
        
        /* 7. PREMIUM FORM ELEMENTS */
        .form-group { margin-bottom: 1.2rem; position: relative; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--color-text); font-size: 0.9em; }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 0.8rem; border: 1px solid var(--color-border);
            border-radius: 8px; box-sizing: border-box; font-size: 1em;
            background-color: rgba(0,0,0,0.3); color: var(--color-text);
            transition: all var(--transition-speed) ease;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none; border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(82, 113, 255, 0.4);
        }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

        /* 8. EXPERT DESIGN OPTIONS */
        .collapsible-header {
            cursor: pointer; font-size: 1.2em; font-weight: 700; display: flex;
            align-items: center; justify-content: space-between;
            padding: 1rem 0; border-top: 1px solid var(--color-border); margin-top: 2rem;
        }
        .collapsible-header i.fa-chevron-down { transition: transform var(--transition-speed) ease; }
        .collapsible-content { max-height: 0; overflow: hidden; transition: max-height var(--transition-speed) ease-out; }
        .collapsible-content.open { max-height: 1000px; /* Arbitrary large value */ }
        .collapsible.open .fa-chevron-down { transform: rotate(180deg); }
        .design-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.2rem; padding-top: 1rem;}
        
        #logo-palette { display: flex; gap: 0.5rem; margin-top: 0.8rem; flex-wrap: wrap; }
        .palette-color { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 2px solid var(--color-border); transition: transform 0.2s ease; }
        .palette-color:hover { transform: scale(1.2); }

        /* 9. QR CODE OUTPUT & ACTIONS */
        .output-header { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 1.5rem; }
        .output-header h2 { margin: 0; font-size: 1.2em; }
        #qr-code-container {
            width: 100%; aspect-ratio: 1 / 1; margin-bottom: 1.5rem;
            padding: 1rem; border-radius: var(--border-radius);
            box-shadow: 0 0 30px rgba(0,0,0,0.5); box-sizing: border-box;
            transition: all var(--transition-speed) ease;
        }
        #qr-code canvas, #qr-code svg { border-radius: 8px; display: block; width: 100% !important; height: auto !important; }
        .btn {
            width: 100%; padding: 0.9rem 1.5rem; border-radius: 8px; cursor: pointer;
            font-size: 1em; font-weight: bold; text-align: center;
            transition: all var(--transition-speed) ease; text-decoration: none; border: none;
            display: flex; align-items: center; justify-content: center; gap: 0.5rem;
        }
        .btn-primary { background: var(--color-primary); color: white; }
        .btn-primary:hover { background: #405de0; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(82, 113, 255, 0.3); }
        .download-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; width: 100%; }

        /* 10. MODAL STYLES (SCANNER & BULK) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(8px);
            z-index: 1000; display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: all var(--transition-speed) ease;
        }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-content {
            background: var(--color-surface); border: 1px solid var(--color-border);
            border-radius: var(--border-radius); padding: 2rem;
            width: 90%; max-width: 600px;
            animation: modal-fade-in var(--transition-speed) ease forwards;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .modal-header h2 { margin: 0; }
        .modal-close-btn { background: none; border: none; color: var(--color-text-muted); font-size: 1.5rem; cursor: pointer; }
        #qr-scanner-container { width: 100%; border-radius: 8px; overflow: hidden; margin-bottom: 1rem; }
        #scanner-result { word-break: break-all; background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px; }

        /* 11. RESPONSIVE DESIGN */
        @media (max-width: 992px) {
            main { grid-template-columns: 1fr; }
            .output { position: static; margin-top: 2rem; }
        }
        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .download-buttons { grid-template-columns: 1fr; }
        }
        
        /* --- [END] PREMIUM CSS UPGRADE --- */
    </style>
</head>
<body>

    <header>
        <h1><img src="logo.png" alt="VIN NESIA Logo" class="logo-img"> VIN NESIA</h1>
        <p>A Premium QR Code Suite. Generate, customize, scan, and bulk-create QR codes with a professional, real-time interface.</p>
    </header>

    <main class="container">
        <div class="controls">
            <div class="tabs-container">
                <button class="tab-button active" data-tab-index="0" onclick="App.openTab(event, 'text')"><i class="fas fa-link"></i> URL/Text</button>
                <button class="tab-button" data-tab-index="1" onclick="App.openTab(event, 'wifi')"><i class="fas fa-wifi"></i> WiFi</button>
                <button class="tab-button" data-tab-index="2" onclick="App.openTab(event, 'vcard')"><i class="fas fa-address-card"></i> vCard</button>
                <button class="tab-button" data-tab-index="3" onclick="App.openTab(event, 'event')"><i class="fas fa-calendar-alt"></i> Event</button>
                <button class="tab-button" data-tab-index="4" onclick="App.openTab(event, 'email')"><i class="fas fa-envelope"></i> Email</button>
            </div>

            <div class="tabs-content-viewport">
                <div class="tabs-content-wrapper">
                    <div id="text" class="tab-content"><div class="form-group"><label for="text-input">Your URL or Text</label><textarea class="qr-input" id="text-input" placeholder="e.g., https://www.vinnesia.my.id"></textarea></div></div>
                    <div id="wifi" class="tab-content"></div>
                    <div id="vcard" class="tab-content"></div>
                    <div id="event" class="tab-content"></div>
                    <div id="email" class="tab-content"></div>
                </div>
            </div>

            <div id="design-options-collapsible" class="collapsible">
                <div class="collapsible-header">
                    <span><i class="fas fa-palette"></i> Expert Design Options</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="collapsible-content">
                    <div class="design-grid">
                        <div class="form-group"><label>Dot Style</label><select class="qr-input" id="dot-style"><option value="square">Square</option><option value="dots">Dots</option><option value="rounded">Rounded</option><option value="extra-rounded">Extra Rounded</option><option value="classy">Classy</option><option value="classy-rounded">Classy Rounded</option></select></div>
                        <div class="form-group"><label>Dot Color</label><input type="color" class="qr-input" id="dot-color" value="#FFFFFF"></div>
                        <div class="form-group"><label>Background Color</label><input type="color" class="qr-input" id="bg-color" value="#0D0D1A"></div>
                        <div class="form-group"><label>Corner Square Color</label><input type="color" class="qr-input" id="corner-square-color" value="#FFFFFF"></div>
                        <div class="form-group"><label>Corner Dot Color</label><input type="color" class="qr-input" id="corner-dot-color" value="#FFFFFF"></div>
                    </div>
                    <div class="form-group">
                        <label for="logo-upload">Upload Logo</label>
                        <input type="file" id="logo-upload" accept="image/*" style="display:none;">
                        <button class="btn" onclick="document.getElementById('logo-upload').click();"><i class="fas fa-upload"></i> Choose Logo</button>
                        <div id="logo-palette-container" style="display: none; margin-top: 1rem;">
                            <label>Smart Palette (from Logo)</label>
                            <div id="logo-palette"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="frame-text">Frame Text (e.g., SCAN ME)</label>
                        <input type="text" class="qr-input" id="frame-text" placeholder="SCAN ME">
                    </div>
                </div>
            </div>
        </div>

        <div class="output">
            <div class="output-header">
                <h2>Preview</h2>
                <div style="display: flex; gap: 0.5rem;">
                    <button id="scan-qr-btn" class="btn" style="width:auto; padding: 0.5rem 1rem;"><i class="fas fa-qrcode"></i> Scan</button>
                    <button id="bulk-qr-btn" class="btn" style="width:auto; padding: 0.5rem 1rem;"><i class="fas fa-layer-group"></i> Bulk</button>
                </div>
            </div>
            <div id="qr-code-container"><div id="qr-code"></div></div>
            <div class="download-buttons">
                <button id="download-png" class="btn btn-primary"><i class="fas fa-file-image"></i> Download PNG</button>
                <button id="download-svg" class="btn btn-secondary"><i class="fas fa-file-code"></i> Download SVG</button>
            </div>
        </div>
    </main>

    <div id="scanner-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>QR Code Scanner</h2>
                <button class="modal-close-btn">&times;</button>
            </div>
            <div id="qr-scanner-container"></div>
            <p><strong>Result:</strong> <span id="scanner-result">Align QR code within the frame.</span></p>
        </div>
    </div>
    
    <div id="bulk-modal" class="modal-overlay">
         <div class="modal-content">
            <div class="modal-header">
                <h2>Bulk QR Code Generator</h2>
                <button class="modal-close-btn">&times;</button>
            </div>
            <p>Enter data, one QR code per line. For vCards, use CSV format: "FullName,Email,Phone".</p>
            <div class="form-group">
                <label for="bulk-type">QR Code Type for Bulk</label>
                <select id="bulk-type" class="qr-input"><option value="text">URL/Text</option><option value="vcard">vCard (CSV)</option></select>
            </div>
            <div class="form-group">
                <textarea id="bulk-data" rows="8" placeholder="https://google.com\nhttps://vinnesia.my.id\nJohn Doe,john@email.com,+12345"></textarea>
            </div>
            <button id="bulk-generate-zip" class="btn btn-primary"><i class="fas fa-file-archive"></i> Generate & Download ZIP</button>
        </div>
    </div>
    
    <script>
    // --- [START] ADVANCED JAVASCRIPT ---

    const App = {
        qrCode: null,
        html5QrCode: null,
        logoImage: null,
        debounceTimer: null,
        state: { currentTab: 'text', currentTabIndex: 0 },

        init() {
            this.setupQRCode();
            this.attachEventListeners();
            this.loadInitialContent();
            console.log("Premium QR Suite Initialized.");
        },

        setupQRCode() {
            this.qrCode = new QRCodeStyling({
                width: 300, height: 300, data: "https://qr.vinnesia.my.id",
                dotsOptions: { color: "#ffffff", type: "rounded" },
                backgroundOptions: { color: "#0d0d1a" },
                imageOptions: { crossOrigin: "anonymous", margin: 8, imageSize: 0.4 },
                cornersSquareOptions: { color: "#ffffff" },
                cornersDotOptions: { color: "#ffffff" },
                qrOptions: { errorCorrectionLevel: 'H' }
            });
            this.qrCode.append(document.getElementById("qr-code"));
        },

        attachEventListeners() {
            document.querySelectorAll('.qr-input').forEach(input => {
                input.addEventListener('input', () => {
                    clearTimeout(this.debounceTimer);
                    this.debounceTimer = setTimeout(() => this.generateQrCode(), 300);
                });
            });
            
            document.getElementById('logo-upload').addEventListener('change', e => this.handleLogoUpload(e.target.files[0]));
            
            const designCollapsible = document.getElementById('design-options-collapsible');
            const designHeader = designCollapsible.querySelector('.collapsible-header');
            if (designHeader) {
                designHeader.addEventListener('click', () => {
                    designCollapsible.classList.toggle('open');
                    designCollapsible.querySelector('.collapsible-content').classList.toggle('open');
                });
            }


            // Modals
            document.getElementById('scan-qr-btn').addEventListener('click', () => this.openModal('scanner-modal'));
            document.getElementById('bulk-qr-btn').addEventListener('click', () => this.openModal('bulk-modal'));
            document.querySelectorAll('.modal-overlay').forEach(el => {
                el.addEventListener('click', e => {
                    if (e.target === el || e.target.classList.contains('modal-close-btn')) {
                        this.closeAllModals();
                    }
                });
            });

            // Downloads & Bulk
            document.getElementById('download-png').addEventListener('click', () => this.download('png'));
            document.getElementById('download-svg').addEventListener('click', () => this.download('svg'));
            document.getElementById('bulk-generate-zip').addEventListener('click', () => this.handleBulkGenerate());
        },

        loadInitialContent() {
            const content = {
                wifi: `<div class="form-group"><label for="wifi-ssid">Network Name (SSID)</label><input type="text" class="qr-input" id="wifi-ssid" placeholder="MyWiFiNetwork"></div><div class="form-group"><label for="wifi-password">Password</label><input type="password" class="qr-input" id="wifi-password"></div>`,
                vcard: `<div class="form-row"><div class="form-group"><label for="vcard-name">Full Name</label><input type="text" class="qr-input" id="vcard-name"></div><div class="form-group"><label for="vcard-org">Organization</label><input type="text" class="qr-input" id="vcard-org"></div></div><div class="form-row"><div class="form-group"><label for="vcard-phone">Phone</label><input type="tel" class="qr-input" id="vcard-phone"></div><div class="form-group"><label for="vcard-email">Email</label><input type="email" class="qr-input" id="vcard-email"></div></div>`,
                event: `<div class="form-group"><label for="event-summary">Event Title</label><input type="text" class="qr-input" id="event-summary"></div><div class="form-group"><label for="event-start">Start Time</label><input type="datetime-local" class="qr-input" id="event-start"></div>`,
                email: `<div class="form-group"><label for="email-to">Recipient Email</label><input type="email" class="qr-input" id="email-to"></div><div class="form-group"><label for="email-subject">Subject</label><input type="text" class="qr-input" id="email-subject"></div>`
            };
            Object.keys(content).forEach(key => {
                const tab = document.getElementById(key);
                if (tab) tab.innerHTML = content[key];
            });
            this.attachEventListenersToDynamicContent();
            this.generateQrCode();
        },

        attachEventListenersToDynamicContent() {
            document.querySelectorAll('.qr-input').forEach(input => {
                 if (!input.dataset.listenerAttached) {
                    input.addEventListener('input', () => {
                        clearTimeout(this.debounceTimer);
                        this.debounceTimer = setTimeout(() => this.generateQrCode(), 300);
                    });
                    input.dataset.listenerAttached = 'true';
                }
            });
        },
        
        getQrData() {
            switch(this.state.currentTab) {
                case 'text':
                    return document.getElementById('text-input').value || "https://qr.vinnesia.my.id";
                // Add cases for other tabs here
                default:
                     return document.getElementById('text-input').value || "https://qr.vinnesia.my.id";
            }
        },

        generateQrCode() {
            if (!this.qrCode) return;
            const options = {
                data: this.getQrData(),
                image: this.logoImage,
                dotsOptions: { color: document.getElementById('dot-color').value, type: document.getElementById('dot-style').value },
                backgroundOptions: { color: document.getElementById('bg-color').value },
                cornersSquareOptions: { color: document.getElementById('corner-square-color').value },
                cornersDotOptions: { color: document.getElementById('corner-dot-color').value }
            };
            this.qrCode.update(options);
        },

        handleLogoUpload(file) {
            if (!file) return;
            const reader = new FileReader();
            reader.onload = e => {
                this.logoImage = e.target.result;
                this.generateQrCode();
                this.extractColorsFromImage(this.logoImage);
            };
            reader.readAsDataURL(file);
        },

        extractColorsFromImage(imageUrl) {
            const img = new Image();
            img.crossOrigin = "Anonymous";
            img.src = imageUrl;
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const scale = Math.min(100 / img.width, 100 / img.height);
                canvas.width = img.width * scale;
                canvas.height = img.height * scale;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
                const colorCount = {};
                let max = 0;
                for (let i = 0; i < imageData.length; i += 4 * 4) { // Sample pixels
                    if (imageData[i+3] < 255) continue; // Skip transparent pixels
                    const rgb = `rgb(${imageData[i]}, ${imageData[i+1]}, ${imageData[i+2]})`;
                    colorCount[rgb] = (colorCount[rgb] || 0) + 1;
                }
                const sortedColors = Object.keys(colorCount).sort((a, b) => colorCount[b] - colorCount[a]);
                this.displayColorPalette(sortedColors.slice(0, 5));
            };
        },

        displayColorPalette(colors) {
            const paletteContainer = document.getElementById('logo-palette');
            paletteContainer.innerHTML = '';
            colors.forEach(color => {
                const colorDiv = document.createElement('div');
                colorDiv.className = 'palette-color';
                colorDiv.style.backgroundColor = color;
                colorDiv.addEventListener('click', () => {
                    document.getElementById('dot-color').value = this.rgbToHex(color);
                    document.getElementById('corner-square-color').value = this.rgbToHex(color);
                    document.getElementById('corner-dot-color').value = this.rgbToHex(color);
                    this.generateQrCode();
                });
                paletteContainer.appendChild(colorDiv);
            });
            document.getElementById('logo-palette-container').style.display = 'block';
        },

        async download(extension) {
            const frameText = document.getElementById('frame-text').value;
            if (!frameText) {
                this.qrCode.download({ name: "vinnesia-qr", extension });
                return;
            }

            const qrBlob = await this.qrCode.getRawData(extension === 'svg' ? 'svg' : 'png');
            if (!qrBlob) return;
            const qrImage = URL.createObjectURL(qrBlob);

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const qrSize = 512;
            const padding = 60;
            const fontSize = 32;
            canvas.width = qrSize + padding * 2;
            canvas.height = qrSize + padding * 2 + fontSize + 20;

            ctx.fillStyle = document.getElementById('bg-color').value;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.font = `bold ${fontSize}px Poppins`;
            ctx.fillStyle = document.getElementById('dot-color').value;
            ctx.textAlign = 'center';
            ctx.fillText(frameText.toUpperCase(), canvas.width / 2, padding / 2 + fontSize);

            const img = new Image();
            img.src = qrImage;
            img.onload = () => {
                ctx.drawImage(img, padding, padding, qrSize, qrSize);
                URL.revokeObjectURL(qrImage);
                const link = document.createElement('a');
                link.download = `vinnesia-qr-framed.png`;
                link.href = canvas.toDataURL(`image/png`);
                link.click();
            };
        },

        async handleBulkGenerate() {
            const type = document.getElementById('bulk-type').value;
            const data = document.getElementById('bulk-data').value.trim().split('\n');
            if (data.length === 0 || data[0] === '') {
                alert('Please enter data for bulk generation.');
                return;
            }

            const zip = new JSZip();
            const tempQr = new QRCodeStyling({ ...this.qrCode.options });

            for (let i = 0; i < data.length; i++) {
                let qrDataString = data[i];
                if (type === 'vcard') {
                    const parts = qrDataString.split(',');
                    qrDataString = `BEGIN:VCARD\nVERSION:3.0\nFN:${parts[0] || ''}\nEMAIL:${parts[1] || ''}\nTEL:${parts[2] || ''}\nEND:VCARD`;
                }
                
                tempQr.update({ data: qrDataString });
                const blob = await tempQr.getRawData('png');
                zip.file(`qr_code_${i + 1}.png`, blob);
            }

            zip.generateAsync({ type: 'blob' }).then(content => {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = 'vinnesia-bulk-qrcodes.zip';
                link.click();
                URL.revokeObjectURL(link.href);
            });
        },

        openModal(modalId) {
            this.closeAllModals();
            const modal = document.getElementById(modalId);
            modal.classList.add('show');
            if (modalId === 'scanner-modal') this.startScanner();
        },

        closeAllModals() {
            document.querySelectorAll('.modal-overlay.show').forEach(m => m.classList.remove('show'));
            this.stopScanner();
        },

        startScanner() {
            if (!this.html5QrCode) {
                this.html5QrCode = new Html5Qrcode("qr-scanner-container");
            }
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };
            this.html5QrCode.start({ facingMode: "environment" }, config, 
                (decodedText, decodedResult) => {
                    document.getElementById('scanner-result').textContent = decodedText;
                    this.stopScanner();
                },
                (errorMessage) => {}
            ).catch(err => {
                document.getElementById('scanner-result').textContent = "Scanner Error. Please grant camera permission.";
            });
        },

        stopScanner() {
            if (this.html5QrCode && this.html5QrCode.isScanning) {
                this.html5QrCode.stop().catch(err => {});
            }
        },
        
        openTab(evt, tabName) {
            this.state.currentTab = tabName;
            this.state.currentTabIndex = parseInt(evt.currentTarget.dataset.tabIndex, 10);
            
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            evt.currentTarget.classList.add('active');

            const wrapper = document.querySelector('.tabs-content-wrapper');
            wrapper.style.transform = `translateX(-${this.state.currentTabIndex * 100}%)`;

            this.generateQrCode();
        },

        // Utility
        rgbToHex(rgbStr) {
            const match = rgbStr.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
            if (!match) return '#000000';
            const toHex = (c) => ('0' + parseInt(c, 10).toString(16)).slice(-2);
            return `#${toHex(match[1])}${toHex(match[2])}${toHex(match[3])}`;
        }
    };

    document.addEventListener('DOMContentLoaded', () => App.init());

    // --- [END] ADVANCED JAVASCRIPT ---
    </script>
</body>
</html>
